/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/resources/js/app.js":
/*!*********************************!*\
  !*** ./src/resources/js/app.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _sass_style_scss__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../sass/style.scss */ \"./src/resources/sass/style.scss\");\n\n\nconst {\n  init\n} = __webpack_require__(/*! ./file-manager */ \"./src/resources/js/file-manager.js\");\n\n$(document).ready(function () {\n  init();\n});\n\n//# sourceURL=webpack://file-manager/./src/resources/js/app.js?");

/***/ }),

/***/ "./src/resources/js/file-manager.js":
/*!******************************************!*\
  !*** ./src/resources/js/file-manager.js ***!
  \******************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("const {\n  apiRequest,\n  truncate\n} = __webpack_require__(/*! ./utils */ \"./src/resources/js/utils.js\");\n\nlet globalTags = [];\nlet globalMediaTypes = [];\nlet globalParents = {};\n\nconst toggleLoader = (prefix, show = true) => {\n  document.querySelector(`${prefix}.selection-area`).innerHTML = '';\n  const loader = document.querySelector(`${prefix}.media-loader`);\n  show ? loader.classList.remove('d-none') : loader.classList.add('d-none');\n};\n\nconst getSelectedTags = prefix => {\n  const tagsIds = [];\n  document.querySelectorAll(`${prefix} .selected .select-tag`).forEach(tagBtn => {\n    tagsIds.push(parseInt(tagBtn.dataset.tag));\n  });\n  return tagsIds;\n};\n\nconst toggleTagBtn = parent => {\n  const isSelected = Object.values(parent.classList).includes('selected');\n  isSelected ? parent.classList.remove('selected') : parent.classList.add('selected');\n};\n\nconst initTagsModal = (prefix, title) => {\n  const modal = document.querySelector('#asign-tag-modal');\n  const selectedMedias = getSelectedMedias(prefix);\n\n  if (selectedMedias.length) {\n    modal.querySelector('.modal-title').textContent = title;\n    const options = globalTags.map(tag => `\n            <option value=\"${tag.id}\">\n                ${tag.name}\n            </option>\n        `);\n    modal.querySelector('.modal-body').innerHTML = `\n            <select name=\"tags\" class=\"asign-tags-select form-control\">\n                ${options}\n            </select>\n        `;\n    $(modal).modal('show');\n    return modal;\n  } else {\n    toast(__('selectMediasFirst'), 'danger');\n    return modal;\n  }\n};\n\nconst initUnsignTag = prefix => {\n  // Asign Tag to medias\n  document.querySelector(`${prefix}#unsign-tag-button`).addEventListener('click', e => {\n    const modal = initTagsModal(prefix, __('removeTag'));\n    const saveBtn = $(`#asign-tag-modal .modal-save`);\n    saveBtn.unbind('click');\n    saveBtn.on('click', e => {\n      const tags = [modal.querySelector('.asign-tags-select').value];\n      const unsignData = {\n        tags,\n        medias: selectedMedias\n      };\n      const formData = new FormData();\n      Object.entries(unsignData).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n      fetch(`/api/media/tag/unsign`, {\n        method: 'POST',\n        body: formData\n      }).then(r => r.json()).then(response => {\n        if (response.data > 0) {\n          toast(__('tagsUnsigned'));\n          $(modal).modal('hide');\n        } else toast(__('tagsUnsignedError'), 'danger');\n      }).catch(e => console.log(e));\n    });\n  });\n};\n\nconst initAsignTag = prefix => {\n  // Asign Tag to medias\n  document.querySelector(`${prefix}#asign-tag-button`).addEventListener('click', e => {\n    const modal = initTagsModal(prefix, __('asignTag'));\n    const saveBtn = $(`#asign-tag-modal .modal-save`);\n    saveBtn.unbind('click');\n    saveBtn.on('click', e => {\n      const tags = [modal.querySelector('.asign-tags-select').value];\n      const asignData = {\n        tags,\n        medias: selectedMedias\n      };\n      const formData = new FormData();\n      Object.entries(asignData).forEach(([key, value]) => {\n        formData.append(key, value);\n      });\n      fetch(`/api/media/tag`, {\n        method: 'POST',\n        body: formData\n      }).then(r => r.json()).then(response => {\n        if (response.data) {\n          toast(__('tagsAsigned'));\n          $(modal).modal('hide');\n        } else toast(__('tagsAsignedError'), 'danger');\n      }).catch(e => console.log(e));\n    });\n  });\n};\n\nconst initTags = (prefix = '', type = false) => {\n  const tagsContainer = document.querySelector(`${prefix}.tags-container ul`);\n  tagsContainer.innerHTML = '';\n  globalTags.forEach(tag => {\n    tagsContainer.innerHTML += `\n            <li class=\"list-group-item\">\n                <a href=\"#\" title=\"${tag.name}\" class=\"select-tag\" data-tag=\"${tag.id}\">\n                    ${truncate(tag.name, 10)}\n                </a>\n            </li>\n        `;\n  });\n  initAsignTag(prefix);\n  initUnsignTag(prefix); // Toggle and refresh media list (filter by tag)\n\n  document.querySelectorAll(`${prefix}.select-tag`).forEach(tagBtn => {\n    tagBtn.addEventListener('click', e => {\n      toggleTagBtn(e.currentTarget.parentNode);\n      const selectedTags = getSelectedTags(prefix);\n      toggleLoader(prefix, true);\n      getMedias(1, selectedTags, type, medias => {\n        renderMediasTable(medias, prefix);\n      });\n    });\n  });\n};\n\nconst toast = (text, type = 'success') => {\n  new Noty({\n    type,\n    text\n  }).show();\n};\n\nconst getSelectedMedias = prefix => {\n  selectedMedias = [];\n  document.querySelectorAll(`${prefix}.selectable.selected`).forEach(selectable => {\n    selectedMedias.push(selectable.dataset.file);\n  });\n  return selectedMedias;\n};\n\nconst initSelectedMediasEdition = (prefix, medias, type) => {\n  document.querySelectorAll(`${prefix}.selected-media`).forEach(element => {\n    element.addEventListener('click', e => {\n      const mediaId = e.currentTarget.dataset.media;\n      const [media] = medias.filter(m => String(m.id) === mediaId);\n      const modal = document.querySelector('#edit-media-modal');\n      modal.querySelector('.modal-body').innerHTML = metadataFormTemplate(globalMediaTypes, media.id);\n      modal.querySelector('.modal-save').innerHTML = 'Save';\n      const parentField = modal.querySelector('select[name=\"parentId\"]');\n      if (parentField !== null) parentField.value = media ? media.parent_id : '';\n      const titleField = modal.querySelector('input[name=\"title\"]');\n      titleField.value = media.media_content ? media.media_content.title : '';\n      const descriptionField = modal.querySelector('textarea[name=\"description\"]');\n      descriptionField.value = media.media_content ? media.media_content.description : ''; // modal.querySelector('select[name=\"type\"]').value = media.type;\n\n      modal.querySelector('.modal-save').addEventListener('click', e => {\n        const mediaData = {\n          title: modal.querySelector('input[name=\"title\"]').value,\n          description: modal.querySelector('textarea[name=\"description\"]').value\n        };\n        if (parentField !== null) mediaData.parent = modal.querySelector('select[name=\"parentId\"]').value;\n        const formData = new FormData();\n        Object.entries(mediaData).forEach(([key, value]) => {\n          formData.append(key, value);\n        });\n        fetch(`/api/media/${media.media_content.id}/edit`, {\n          method: 'POST',\n          body: formData\n        }).then(r => r.json()).then(data => {\n          modal.querySelectorAll('small.text-danger').forEach(err => err.remove());\n\n          if (!data.errors && data.data.updated) {\n            document.querySelector(`${prefix}.selected-media[data-media=\"${media.id}\"]`).outerHTML = selectedMediaTemplate(data.data.media);\n            modal.querySelector('.modal-save').innerHTML = `<span class=\"modal-loader la la-spinner la-spin\"></span>`;\n            toggleLoader(prefix, true);\n            getMedias(1, '', type, medias => {\n              initSelectedMediasEdition(prefix, medias.data, type);\n              renderMediasTable(medias, prefix, type);\n              $(modal).modal('hide');\n              toast(__('mediaUpdated'));\n            });\n          } else {\n            Object.entries(data.errors).forEach(([name, errors]) => {\n              const field = modal.querySelector(`input[name=\"${name}\"], textarea[name=\"${name}\"], select[name=\"${name}\"]`);\n              errors.forEach(error => {\n                field.parentElement.innerHTML += `<small class=\"text-danger\">${error}</small>`;\n              });\n            });\n          }\n        });\n      });\n      $(modal).modal('show');\n    });\n  });\n};\n\nconst selectedMediaTemplate = media => {\n  return `\n    <a href=\"#\" data-media=\"${media.id}\" class=\"selected-media list-group-item list-group-item-action flex-column align-items-start\">\n        <div class=\"d-flex w-100 justify-content-between\">\n            <div>\n                <b class=\"mb-1 m-0\">${media.media_content ? media.media_content.title : media.name}</b></br>  \n                <small class=\"mb-1\">${media.media_content ? media.media_content.description : __('noDescription')}</small>\n            </div>\n            <div>\n                <img src=\"${media.media_content.preview}\">\n            </div>\n        </div>\n    </a>\n`;\n};\n\nconst initSelection = (medias, prefix, type) => {\n  const selection = new SelectionArea({\n    boundaries: ['html'],\n    selectables: ['.selection-area > .selectable']\n  }).on('start', ({\n    store,\n    event\n  }) => {\n    if (!event.ctrlKey && !event.metaKey) {\n      for (const el of store.stored) {\n        el.classList.remove('selected');\n      }\n\n      selection.clearSelection();\n    }\n  }).on('move', ({\n    store: {\n      changed: {\n        added,\n        removed\n      }\n    }\n  }) => {\n    for (const el of added) {\n      el.classList.add('selected');\n    }\n\n    for (const el of removed) {\n      el.classList.remove('selected');\n    }\n  });\n\n  if (prefix !== '') {\n    document.querySelector(`${prefix}#selectFilesBtn`).addEventListener('click', () => {\n      const selectedMedias = getSelectedMedias(prefix);\n      document.querySelector(`${prefix} .selected-medias-input`).value = JSON.stringify({\n        medias: selectedMedias\n      });\n      const selectedMediasContainer = document.querySelector(`${prefix}.selected-medias-list`);\n      selectedMediasContainer.innerHTML = '';\n      document.querySelector(`${prefix}.selected-medias-number`).innerHTML = `\n                ${selectedMedias.length}\n            `;\n\n      if (selectedMedias.length > 0) {\n        medias.forEach(media => {\n          if (selectedMedias.includes(String(media.id))) {\n            selectedMediasContainer.innerHTML += selectedMediaTemplate(media);\n          }\n        });\n        initSelectedMediasEdition(prefix, medias, type);\n      } else {\n        selectedMediasContainer.innerHTML = `\n                    <li class=\"list-group-item\">\n                        <small>${__('noMediasSelected')}</small>\n                    </li>\n                `;\n      }\n    });\n  }\n};\n\nconst mediaItemTemplate = media => {\n  return `\n    <div title=\"${media.media_content.title}\" class=\"selectable col-md-2 col-sm-3 m-1\" data-file=\"${media.id}\">\n        <img src=\"${media.media_content.preview}\">\n        <small>${truncate(media.media_content.title, 10)}</small>\n    </div>\n    `;\n};\n\nconst initScroll = (container, lastPage, prefix = '', type) => {\n  let page = 1;\n  let isLoading = false;\n  $(container).unbind('scroll');\n  $(container).on('scroll', e => {\n    if (container.offsetHeight + container.scrollTop >= container.scrollHeight - 1) {\n      if (!isLoading && page + 1 <= lastPage) {\n        page += 1;\n        isLoading = true;\n        container.innerHTML += `\n                <div class=\"pagination-loader col-sm-12 d-flex justify-content-center m-0\">\n                    <h4><span class=\"la la-spinner la-spin mt-3\"></span></h4>\n                </div>`;\n        getMedias(page, getSelectedTags(prefix), type, mediasResponse => {\n          container.querySelector('.pagination-loader').remove();\n          const medias = mediasResponse.data;\n          medias.forEach(media => {\n            container.innerHTML += mediaItemTemplate(media);\n          });\n          isLoading = false;\n          if (prefix !== '') initSelection(medias, prefix, type);\n        });\n      }\n    }\n  });\n};\n\nconst renderMediasTable = (medias, prefix, type) => {\n  toggleLoader(prefix, false);\n  const container = document.querySelector(`${prefix} .custom-file-manager .list`);\n  container.innerHTML = '';\n\n  if (medias.data.length) {\n    medias.data.forEach(media => {\n      // const tags = globalTags.filter(tag => media.tags.includes(tag.id));\n      container.innerHTML += mediaItemTemplate(media);\n      initScroll(container, medias.last_page, prefix, type);\n      initSelection(medias.data, prefix, type);\n    });\n  } else {\n    container.innerHTML = `<tr><td class=\"empty\" colspan=\"6\">${__('noMediasFound')}</td></tr>`;\n  }\n};\n\nconst getMedias = (page = 1, tags = null, type = false, callback = false) => {\n  apiRequest(`/admin/media/fetch/media?page=${page}`, mediasResponse => {\n    callback(mediasResponse);\n  }, 'POST', {\n    _token: document.querySelector('meta[name=csrf-token]').content,\n    tags,\n    type\n  });\n};\n\nconst loadGlobals = (callback = false) => {\n  toggleLoader('', true);\n  apiRequest('/admin/file-manager/api/mediaTag/ajax/search', tagsResponse => {\n    globalTags = tagsResponse.data;\n    apiRequest('/admin/file-manager/api/mediaType/ajax/search', typesResponse => {\n      globalMediaTypes = typesResponse.data;\n      apiRequest('/admin/media/fetch/parent', parentsResponse => {\n        Object.entries(parentsResponse.data).forEach(([entity, response]) => {\n          const parentList = {};\n          Object.values(response.data).forEach(parent => {\n            parentList[parent.id] = parent.name || parent.title || parent.label || parent.slug;\n          });\n          globalParents[entity] = parentList;\n        });\n        if (callback) callback();\n      }, 'POST', {\n        _token: document.querySelector('meta[name=csrf-token]').content\n      });\n    });\n  });\n};\n\nconst initRefresh = (prefix = '', type = false) => {\n  document.querySelector(`${prefix}#refreshBtn`).addEventListener('click', e => {\n    toggleLoader(prefix, true);\n    getMedias(1, '', type, medias => {\n      renderMediasTable(medias, prefix, type);\n    });\n  });\n};\n\nconst mediaUploadPromise = (media, metadata) => {\n  const formData = new FormData();\n  formData.append('media', media.media);\n  formData.append('cropped', media.cropped ? media.cropped : null);\n  formData.append('name', media.media.name);\n  Object.entries(metadata).forEach(([key, value]) => formData.append(key, value));\n  return fetch('/api/media/upload', {\n    method: 'POST',\n    body: formData\n  });\n};\n\nconst typesListTemplate = types => {\n  let typesList = '';\n  types.forEach(type => {\n    typesList += `<option value=\"${type.id}\">${type.name}</option>`;\n  });\n  return `\n    <div class=\"form-group\">\n        <label>${__('mediaType')}</label>\n        <select name=\"type\" class=\"form-control\">\n            ${typesList}\n        </select></div>`;\n};\n\nconst metadataFormTemplate = (types, i) => {\n  let select = `\n        <div class=\"form-group\">\n            <label>${__('parent')}</label>\n            <select id=\"parent-select-${i}\" class=\"select2-parent\" name=\"parentId\" style=\"width:100%\">\n            </select>\n        </div>\n    `;\n  return `\n    <form id=\"metadata-form-${i}\">\n        ${select}\n        <div class=\"form-group\">\n            <label>${__('title')}</label>\n            <input name=\"title\" type=\"text\" class=\"form-control\">\n        </div>\n        <div class=\"form-group\">\n            <label>${__('description')}</label>\n            <textarea name=\"description\" class=\"form-control\"></textarea>\n        </div>\n        ${typesListTemplate(types)}\n    </form>`;\n};\n\nconst cropImageTemplate = (media, i) => {\n  const tmpImg = document.createElement('img');\n  tmpImg.classList.add('to_be_crop_' + i);\n  tmpImg.style.maxWidth = '100%';\n  tmpImg.src = URL.createObjectURL(media);\n  var buttonConfirm = document.createElement('button');\n  buttonConfirm.textContent = 'Confirm';\n  buttonConfirm.classList.add('confirm-crop');\n  buttonConfirm.classList.add('btn');\n  buttonConfirm.classList.add('btn-default');\n  buttonConfirm.classList.add('btn-sm');\n  buttonConfirm.id = \"crop_btn_\" + i;\n  buttonConfirm.dataset.id = i;\n  return `<div class=\"d-none\" id=\"imageCropper_${i}\">\n                ${buttonConfirm.outerHTML}\n                ${tmpImg.outerHTML}\n            </div>`;\n};\n\nconst renderUploadMediaList = (medias, types) => {\n  const mediasList = document.querySelector('#upload-modal .medias-list');\n  mediasList.innerHTML = '';\n  let i = 0;\n  medias.forEach(media => {\n    media = media.media;\n    let mediaTemplate = '';\n    let hasVideo = false;\n    let hasAudio = false;\n    const typesWithoutPreview = ['video/avi'];\n\n    if (typesWithoutPreview.includes(media.type)) {\n      mediaTemplate = `<small>${__('noPreview', [media.type])}</small>`;\n    } else if (/^image/.test(media.type)) {\n      if (media.type !== 'image/gif') {\n        const cropBtn = `\n                    <button id=\"crop-btn-${i}\" class=\"form-control btn btn-default btn-sm crop-btn\" data-id=\"${i}\">\n                        ${__('crop')}\n                    </button>`;\n        mediaTemplate = `\n                    <img id=\"image-preview-${i}\" class=\"w-100 my-3\" src=\"${URL.createObjectURL(media)}\">\n                    ${cropBtn}\n                    <div class=\"mt-1\" id=\"crop_image_${i}\">\n                        ${cropImageTemplate(media, i)}\n                    </div>\n                `;\n      } else {\n        mediaTemplate = `\n                    <img id=\"image-preview-${i}\" class=\"w-100 my-3\" src=\"${URL.createObjectURL(media)}\">\n                `;\n      }\n    } else if (/^video/.test(media.type)) {\n      hasVideo = true;\n      mediaTemplate = `\n                <video controls id=\"video-preview-video-${i}\" class=\"w-100 my-3\">\n                    <source id=\"video-preview-source-${i}\" src=\"splashVideo\">\n                    Your browser does not support the video tag.\n                </video>`;\n    } else if (/^audio/.test(media.type)) {\n      hasAudio = true;\n      mediaTemplate = `\n            <audio class=\"w-100 my-3\" id=\"audio-preview-audio-${i}\" controls>\n                <source src=\"\" id=\"audio-preview-source-${i}\" />\n            </audio>`;\n    }\n\n    mediasList.innerHTML += `\n                <div class=\"card file-row\" data-name=\"${media.name}\">\n                    <div class=\"card-header\" id=\"heading_${i}\">\n                        <h5 class=\"mb-0\" style=\"text-align:center\">\n                            <button\n                                class=\"btn btn-link\"\n                                data-toggle=\"collapse\"\n                                data-target=\"#collapse_${i}\"\n                                aria-expanded=\"true\"\n                                aria-controls=\"collapse_${i}\"\n                            >${media.name} <small>${media.size} KB</small> <span class=\"loader-container\"></span>\n                            </button>\n                            <a href=\"#\" style=\"float:right\" class=\"text-danger\">\n                                <i style=\"vertical-align:middle\" data-name=\"${media.name}\" class=\"remove-media-btn las la-trash-alt\"></i>\n                            </a>\n                        </h5>\n                    </div>\n                    <div\n                        id=\"collapse_${i}\" \n                        class=\"collapse\"\n                        aria-labelledby=\"heading_${i}\"\n                        data-parent=\"#accordion\">   \n                        <div class=\"card-body\">\n                            ${mediaTemplate}\n                            ${metadataFormTemplate(types, i)}\n                        </div>\n                    </div>\n                </div>`;\n\n    if (hasVideo) {\n      const reader = new FileReader();\n      const x = i;\n\n      reader.onloadend = () => {\n        const video = document.querySelector(`#video-preview-video-${x}`);\n        video.src = reader.result;\n      };\n\n      reader.readAsDataURL(media);\n    }\n\n    if (hasAudio) {\n      document.querySelector(`#audio-preview-source-${i}`).src = URL.createObjectURL(media);\n      document.querySelector(`#audio-preview-audio-${i}`).load();\n    }\n\n    const finished = [];\n    const x = i;\n    $(`#parent-select-${i}`).select2({\n      ajax: {\n        url: '/api/media/parent',\n        dataType: 'json',\n        processResults: function ({\n          data\n        }) {\n          const parentsNumber = Object.keys(data).length;\n          const results = [];\n          let more;\n\n          if (parentsNumber > 1) {\n            Object.entries(data).forEach(([namespace, response]) => {\n              if (response.current_page === response.last_page) finished.push(namespace);\n\n              if (response.data.length) {\n                results.push({\n                  text: namespace.split('\\\\').pop(),\n                  children: Object.values(response.data).map(entry => {\n                    return {\n                      id: entry.id,\n                      text: entry.name,\n                      namespace,\n                      i: x\n                    };\n                  })\n                });\n              }\n            });\n            more = finished.length < parentsNumber;\n          } else {\n            Object.entries(data).forEach(([namespace, response]) => {\n              Object.values(response.data).forEach(entry => {\n                results.push({\n                  id: entry.id,\n                  text: entry.name,\n                  namespace,\n                  i: x\n                });\n              });\n              more = response.current_page < response.last_page;\n            });\n          }\n\n          return {\n            results,\n            pagination: {\n              more\n            }\n          };\n        },\n        data: params => {\n          const query = {\n            search: params.term,\n            page: params.page || 1\n          };\n          return query;\n        }\n      }\n    }).on('select2:select', e => {\n      const data = e.params.data;\n      $(`#parent-select-${data.i}`).children()[0].dataset.namespace = data.namespace;\n    });\n    i += 1;\n  });\n};\n\nconst initCropper = i => {\n  const imgTobeCrop = document.querySelector('.to_be_crop_' + i);\n  let ImgCrop = new Cropper(imgTobeCrop, {\n    aspectRatio: '1/1'\n  });\n  const buttonConfirm = document.querySelector('#crop_btn_' + i);\n  buttonConfirm.addEventListener('click', function (e) {\n    let canvas = ImgCrop.getCroppedCanvas();\n\n    if (canvas !== null) {\n      canvas.toBlob(function (blob) {\n        blob.lastModifiedDate = new Date();\n        blob.lastModified = new Date();\n        const croppedImage = new File([blob], mediaList[i].media.name, {\n          type: blob.type\n        });\n        mediaList[i].media = croppedImage;\n        document.querySelector(`#image-preview-${i}`).src = URL.createObjectURL(croppedImage);\n        $(`#crop-btn-${i}`).click();\n        toast(__('imageCropped'));\n      });\n    }\n  });\n};\n\nconst initUploadModal = (medias, types) => {\n  const titleSpan = document.querySelector('#upload-modal .modal-title span');\n  const button = document.querySelector('#upload-modal .modal-save');\n  const buttonSpan = button.querySelector('span');\n  const totalMedias = medias.length;\n  renderUploadMediaList(medias, types);\n  button.classList.remove('d-none');\n  titleSpan.innerHTML = totalMedias;\n  buttonSpan.innerHTML = totalMedias;\n  const removeMediaBtns = document.querySelectorAll('.remove-media-btn');\n  removeMediaBtns.forEach(removeBtn => {\n    removeBtn.addEventListener('click', e => {\n      const mediaName = e.target.dataset.name;\n      medias = medias.filter(media => {\n        return media.media.name != mediaName;\n      });\n      initUploadModal(medias, types);\n    });\n  });\n  $('#upload-modal .modal-save').unbind().click(e => {\n    e.currentTarget.classList.add('d-none');\n    const promises = [];\n    const promiseResponses = [];\n    let i = 0;\n    const fileNames = document.querySelectorAll('span.loader-container');\n    fileNames.forEach(fileName => fileName.innerHTML += `<span class=\"ml-2 la la-spinner la-spin\"></span>`);\n    medias.forEach(media => {\n      const metadataFields = document.querySelectorAll(`#metadata-form-${i} .form-control`);\n      const metadata = {};\n      metadataFields.forEach(field => metadata[field.name] = field.value);\n      const parentSelect = document.querySelector(`#metadata-form-${i} select[name=\"parentId\"]`);\n\n      if (parentSelect !== null) {\n        let dataAttrs = $(parentSelect).find(':selected').data();\n\n        if (dataAttrs !== undefined) {\n          metadata.parent_model = dataAttrs.namespace;\n        }\n      }\n\n      promises.push(mediaUploadPromise(media, metadata));\n      i += 1;\n    });\n    Promise.all(promises).then(responses => {\n      responses.forEach(response => {\n        if (response.ok) {\n          promiseResponses.push(response.json());\n        }\n      });\n    }, e => {\n      console.log({\n        e\n      });\n    }).then(() => {\n      Promise.all(promiseResponses).then(responses => {\n        responses.forEach(response => {\n          const fileRow = document.querySelector(`.file-row[data-name=\"${response.data.filename}\"]`);\n          document.querySelectorAll('small.text-danger').forEach(err => err.remove());\n\n          if (!response.errors) {\n            const {\n              msg,\n              success\n            } = response.data;\n            const fileLoader = fileRow.querySelector('span.loader-container');\n            fileLoader.classList.value = 'ml-2';\n            fileLoader.innerHTML = success ? '✅' : '❌';\n            fileRow.querySelector('.card-header').innerHTML += `\n                                    <p class=\"mt-2 mb-0 text-${success ? 'success' : 'danger'} text-center\">\n                                        ${msg}\n                                    </p>\n                                `;\n          } else if (fileRow) {\n            Object.entries(response.errors).forEach(([name, errors]) => {\n              const field = fileRow.querySelector(`input[name=\"${name}\"], select[name=\"${name}\"]`);\n              errors.forEach(error => {\n                field.parentElement.innerHTML += `<small class=\"text-danger\">${error}</small>`;\n              });\n            });\n            const fileLoader = fileRow.querySelector('span.loader-container');\n            fileLoader.innerHTML = '❌';\n            fileRow.querySelector('.card-header').innerHTML += `\n                                    <p class=\"mt-2 mb-0 text-danger text-center\">\n                                        ${__('invalidMetadata')}\n                                    </p>\n                                `;\n          }\n        });\n      });\n    });\n  });\n  $('.crop-btn').unbind().click(e => {\n    const i = e.target.dataset.id;\n    const imageCropper = document.querySelector('#imageCropper_' + i);\n    initCropper(i);\n\n    if (Object.values(imageCropper.classList).includes('d-none')) {\n      imageCropper.classList.remove('d-none');\n    } else {\n      imageCropper.classList.add('d-none');\n    }\n  });\n};\n\nlet modalShown = false;\nlet mediaList = [];\n\nconst initUpload = prefix => {\n  const hiddenInput = document.querySelector(`${prefix} #upload-field`);\n  const uploadButton = document.querySelector(`${prefix} #upload-button`);\n  const uploadModal = $('#upload-modal');\n\n  const uploadClickListener = e => {\n    hiddenInput.value = '';\n    hiddenInput.click();\n  };\n\n  $(uploadButton).unbind('click');\n  $(uploadButton).on('click', uploadClickListener);\n  hiddenInput.addEventListener('change', e => {\n    mediaList = [];\n    hiddenInput.files.forEach(media => mediaList.push({\n      media,\n      cropped: null\n    }));\n\n    if (!modalShown) {\n      uploadModal.modal('show');\n      modalShown = true;\n    }\n  });\n};\n\nconst initMediaButton = prefix => {\n  const buttonContainer = document.querySelector(`${prefix}.browse-media-btn-container`);\n  const button = buttonContainer.querySelector('.filemanager-toggle');\n  const loader = buttonContainer.querySelector('.la-spinner');\n  button.disabled = false;\n  loader.remove();\n};\n\nconst initMediaField = (medias, prefix, type) => {\n  renderMediasTable(medias, prefix, type);\n  initSelectedMediasEdition(prefix, medias.data, type);\n  const loadedEvent = new Event('medias-loaded');\n  document.querySelector(`${prefix} #filemanager-container`).dispatchEvent(loadedEvent);\n  initTags(prefix, type);\n  initRefresh(prefix, type);\n  initUpload(prefix);\n  initUploadModalHandler(prefix, type);\n  initMediaButton(prefix);\n};\n\nconst onMediaLoadedSingle = medias => {\n  renderMediasTable(medias, '');\n  initTags();\n  initRefresh();\n  initUpload('');\n  initUploadModalHandler();\n};\n\nconst initUploadModalHandler = (prefix = '', type = false) => {\n  const uploadModal = $('#upload-modal');\n  uploadModal.on('shown.bs.modal', e => initUploadModal(mediaList, globalMediaTypes));\n  uploadModal.on('hidden.bs.modal', e => {\n    modalShown = false; // Refresh After Upload\n\n    toggleLoader(prefix, true);\n    getMedias(1, '', type, medias => {\n      renderMediasTable(medias, prefix, type);\n    });\n  });\n};\n\nconst onGlobalsLoaded = () => {\n  //Render upload modal\n  const modalTemplate = document.querySelector('template.upload-modal');\n  const node = modalTemplate.content.cloneNode(true);\n  document.body.appendChild(node); // Init each field\n\n  const fileManagerFields = document.querySelectorAll('.filemanager-field.modal-dialog');\n\n  if (fileManagerFields.length) {\n    fileManagerFields.forEach(fileManagerField => {\n      const name = fileManagerField !== null ? fileManagerField.getAttribute('name') : false;\n      const prefix = name ? `.filemanager-field[name=\"${name}\"] ` : '';\n      const type = fileManagerField.dataset.type;\n      getMedias(1, '', type, medias => {\n        initMediaField(medias, prefix, type);\n      });\n    });\n  } else {\n    getMedias(1, '', false, medias => {\n      onMediaLoadedSingle(medias);\n    });\n  }\n};\n\nconst init = () => {\n  loadGlobals(onGlobalsLoaded);\n};\n\nmodule.exports = {\n  init\n};\n\n//# sourceURL=webpack://file-manager/./src/resources/js/file-manager.js?");

/***/ }),

/***/ "./src/resources/js/utils.js":
/*!***********************************!*\
  !*** ./src/resources/js/utils.js ***!
  \***********************************/
/***/ ((module) => {

eval("const apiRequest = (endpoint, callback, method = 'GET', data = false, headers = false, err = false) => {\n  const head = new Headers();\n\n  if (headers) {\n    Object.entries(headers).forEach(([key, val]) => head.append(key, val));\n  } else {\n    head.append('Accept', 'application/json');\n  }\n\n  let formData = null;\n\n  if (data) {\n    formData = new FormData();\n\n    for (const [key, value] of Object.entries(data)) {\n      if (key && value) {\n        if (typeof value === 'object') {\n          // Array\n          if (Array.isArray(value)) {\n            for (const [, subValue] of Object.entries(value)) {\n              formData.append(`${key}[]`, subValue);\n            }\n          } // Object\n          else {\n            if (value instanceof File) {\n              formData.append(key, value);\n            } else {\n              formData.append(key, JSON.stringify(value));\n            }\n          }\n        } // Default\n        else {\n          formData.append(key, value);\n        }\n      }\n    }\n  }\n\n  fetch(document.location.origin + endpoint, {\n    method,\n    headers: head,\n    body: formData\n  }).then(response => response.json()).then(data => callback(data)).catch(e => {\n    err ? err(e) : console.log(e);\n  });\n};\n\nconst truncate = (str, length, ending = '...') => {\n  if (str.length > length) {\n    return str.substring(0, length - ending.length) + ending;\n  }\n\n  return str;\n};\n\nmodule.exports = {\n  apiRequest,\n  truncate\n};\n\n//# sourceURL=webpack://file-manager/./src/resources/js/utils.js?");

/***/ }),

/***/ "./src/resources/sass/style.scss":
/*!***************************************!*\
  !*** ./src/resources/sass/style.scss ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://file-manager/./src/resources/sass/style.scss?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/resources/js/app.js");
/******/ 	
/******/ })()
;